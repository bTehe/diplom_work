{% extends "base.html" %} {% block content %}
<div class="container mt-5">
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h3 class="mb-0">üéì –ù–∞–≤—á–∞–Ω–Ω—è –ú–æ–¥–µ–ª—ñ</h3>
    </div>
    <div class="card-body">
      {# ‚Äî FLASH-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ‚Äî #} {% with messages =
      get_flashed_messages(with_categories=true) %} {% if messages %}
      <div class="mb-4">
        {% for category, message in messages %}
        <div
          class="alert alert-{{ 
                  'success' if category=='success' else 
                  'info'    if category=='info'    else 
                  'warning' if category=='warning' else 
                  'danger' 
                }} mb-3"
          role="alert"
        >
          {{ message }}
        </div>
        {% endfor %}
      </div>
      {% endif %} {% endwith %} {# ‚Äî –§–æ—Ä–º–∞ –∑–∞–ø—É—Å–∫—É ‚Äî #}
      <form method="post" class="row gx-4 gy-4 mb-4">
        <div class="col-md-6">
          <label for="filename" class="form-label">–í–∏–±—ñ—Ä –æ–±—Ä–æ–±–ª–µ–Ω–æ–≥–æ CSV</label>
          <select name="filename" id="filename" class="form-control" required>
            <option value="">‚Äî –û–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª ‚Äî</option>
            {% for f in files %}
            <option value="{{ f }}">{{ f }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3">
          <label for="batch_size" class="form-label">Batch Size</label>
          <input
            type="number"
            name="batch_size"
            id="batch_size"
            class="form-control"
            value="64"
            min="1"
          />
        </div>

        <div class="col-md-3">
          <label for="epochs" class="form-label">Epochs</label>
          <input
            type="number"
            name="epochs"
            id="epochs"
            class="form-control"
            value="20"
            min="1"
          />
        </div>

        <div class="col-12 text-end">
          <button type="submit" class="btn btn-primary px-4">
            <i class="bi bi-play-circle me-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è
          </button>
        </div>
      </form>

      {% if metrics %}
      <hr class="my-4" />

      {# ‚Äî –ö–∞—Ä—Ç–∫–∏ –∑ –∫–ª—é—á–æ–≤–∏–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ ‚Äî #}
      <div class="row gy-4 mb-4">
        <div class="col-md-4">
          <div class="card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
              <h6 class="card-title">üìÅ –ú–æ–¥–µ–ª—å –∑–±–µ—Ä–µ–∂–µ–Ω–∞</h6>
              <p class="card-text small text-truncate">
                {{ metrics.model_path }}
              </p>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
              <h6 class="card-title">üéØ –¢–µ—Å—Ç–æ–≤–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å</h6>
              <p class="card-text display-5 mb-0">
                {{ metrics.test_accuracy }}
              </p>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
              <h6 class="card-title">üíæ Test Loss</h6>
              <p class="card-text display-5 mb-0">{{ metrics.test_loss }}</p>
            </div>
          </div>
        </div>
      </div>

      {# ‚Äî –¢–∞–±–ª–∏—Ü—è —ñ—Å—Ç–æ—Ä—ñ—ó –ø–æ –µ–ø–æ—Ö–∞—Ö ‚Äî #}
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Epoch</th>
              <th>Loss</th>
              <th>Val Loss</th>
              <th>Accuracy</th>
              <th>Val Accuracy</th>
            </tr>
          </thead>
          <tbody>
            {% for i in range(metrics.history.loss|length) %}
            <tr>
              <td>{{ i+1 }}</td>
              <td>{{ metrics.history.loss[i]|round(4) }}</td>
              <td>{{ metrics.history.val_loss[i]|round(4) }}</td>
              <td>{{ metrics.history.accuracy[i]|round(4) }}</td>
              <td>{{ metrics.history.val_accuracy[i]|round(4) }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
